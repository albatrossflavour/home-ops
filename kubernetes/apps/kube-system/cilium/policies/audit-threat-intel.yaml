---
# yaml-language-server: $schema=https://raw.githubusercontent.com/datreeio/CRDs-catalog/main/cilium.io/ciliumnetworkpolicy_v2.json
apiVersion: "cilium.io/v2"
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: audit-threat-intel
  annotations:
    policy.cilium.io/description: "AUDIT MODE: Log traffic from known threat sources (Tor, VPNs, botnets)"
    policy.cilium.io/mode: "audit"
spec:
  description: "Audit mode - log traffic from known bad sources but DO NOT BLOCK (yet)"
  endpointSelector: {}
  # NOTE: Empty ingressDeny means AUDIT ONLY - we log but allow traffic
  # This lets us monitor for false positives before enforcing
  ingress:
    # Monitor traffic from Tor exit nodes (sample range)
    - fromCIDRSet:
        # Tor Project exit node range (example - needs updating from threat feeds)
        - cidr: 185.220.100.0/22
          # except: []  # Could whitelist specific IPs if needed
      toPorts:
        - ports:
            - port: "80"
              protocol: TCP
            - port: "443"
              protocol: TCP
      # NOTE: This block ALLOWS traffic in audit mode
      # It will show in Hubble/logs but not block

    # Monitor traffic from known VPN/proxy ranges (example)
    - fromCIDRSet:
        # Common VPN provider ranges (examples - not comprehensive)
        - cidr: 45.142.120.0/22   # Example VPN range
      toPorts:
        - ports:
            - port: "80"
              protocol: TCP
            - port: "443"
              protocol: TCP

  # Empty ingressDeny = audit only, no blocking
  ingressDeny: []
